<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>마이페이지 - 메시징 서비스</title>
    <script src="js/header.js"></script>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/layout.css">
    <style>
        /* 대시보드 요약 (회원유형·등급·잔액·발송가능건수) - main과 동일 */
        .dashboard-summary {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            padding: 28px 32px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }
        .dashboard-summary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1.4fr 2fr;
            gap: 0;
            align-items: center;
            min-height: 56px;
        }
        .dashboard-summary-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding-left: 24px;
            border-left: 1px solid #e2e8f0;
        }
        .dashboard-summary-item:first-child { padding-left: 0; border-left: none; }
        .dashboard-summary-label { font-size: 12px; color: #64748b; font-weight: 500; }
        .dashboard-summary-value { font-size: 16px; font-weight: 600; color: #1e293b; }
        .dashboard-summary-balance-row { display: flex; align-items: center; gap: 6px; font-size: 14px; font-weight: 600; color: #1e293b; }
        .dashboard-summary-balance-row span.unit { font-size: 13px; font-weight: 500; color: #64748b; margin-left: 2px; }
        #dashboardBalance { display: flex; flex-direction: column; gap: 8px; }
        .dashboard-summary-balance-line { display: flex; align-items: center; gap: 16px; flex-wrap: wrap; }
        .dashboard-summary-balance-line .dashboard-summary-balance-row { margin: 0; }
        .dashboard-summary-dedicated-account { margin-top: 10px; padding-top: 10px; border-top: 1px solid #e2e8f0; font-size: 12px; color: #64748b; }
        .dashboard-summary-dedicated-account-label { font-weight: 600; color: #475569; margin-bottom: 4px; }
        .dashboard-summary-dedicated-account-content { font-size: 12px; line-height: 1.5; }
        .dashboard-summary-caller-count-link { color: var(--primary-color); font-weight: 600; text-decoration: none; cursor: pointer; }
        .dashboard-summary-caller-count-link:hover { text-decoration: underline; }
        .dashboard-summary-send-counts { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; }
        .dashboard-summary-send-badge {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 6px 12px; background: #fff; border-radius: 10px; font-size: 13px; color: #475569;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
        }
        .dashboard-summary-send-badge span:last-child { font-weight: 700; color: #2563eb; }
        @media (max-width: 1024px) {
            .dashboard-summary-grid { grid-template-columns: repeat(2, 1fr); }
            .dashboard-summary-item { padding-left: 0; border-left: none; padding-top: 16px; padding-bottom: 16px; border-top: 1px solid #e2e8f0; }
            .dashboard-summary-item:nth-child(1), .dashboard-summary-item:nth-child(2) { border-top: none; }
            .dashboard-summary-item:nth-child(odd) { padding-right: 20px; }
        }
        @media (max-width: 600px) {
            .dashboard-summary { padding: 20px; }
            .dashboard-summary-grid { grid-template-columns: 1fr; }
            .dashboard-summary-item { border-top: 1px solid #e2e8f0; padding-top: 16px; padding-bottom: 16px; }
            .dashboard-summary-item:first-child { padding-top: 0; border-top: none; }
        }

        /* 마이페이지 LNB + 콘텐츠 레이아웃 */
        .mypage-layout {
            display: grid;
            grid-template-columns: 220px 1fr;
            gap: 32px;
            align-items: start;
        }
        .mypage-lnb {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 12px 0;
            position: sticky;
            top: 88px;
        }
        .mypage-lnb-item {
            display: block;
            width: 100%;
            padding: 12px 20px;
            text-align: left;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            text-decoration: none;
            border: none;
            background: none;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }
        .mypage-lnb-item:hover {
            background: var(--bg-color);
            color: var(--primary-color);
        }
        .mypage-lnb-item.active {
            background: rgba(37, 99, 235, 0.08);
            color: var(--primary-color);
            border-left-color: var(--primary-color);
        }
        .mypage-content-panel {
            display: none;
        }
        .mypage-content-panel.active {
            display: block;
        }
        .mypage-panel-intro {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 20px;
            line-height: 1.6;
        }
        .mypage-panel-actions {
            margin-top: 24px;
        }

        /* 이용내역: 기간 조회 */
        .card-header-with-period { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px; }
        .card-header-with-period .card-title { margin: 0; }
        .history-period-filter { display: flex; flex-wrap: wrap; align-items: center; gap: 12px; }
        .history-period-dates { display: flex; align-items: center; gap: 8px; }
        .history-period-dates .form-input.input-sm { width: 140px; padding: 6px 10px; font-size: 13px; }
        .history-period-sep { color: var(--text-secondary); font-size: 14px; }
        .history-period-btns { display: flex; gap: 6px; }
        /* 이용내역: history tabs & table (payment-refund와 동일) */
        .history-tabs { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; margin-bottom: 16px; }
        .history-tabs-right { margin-left: auto; }
        .history-tab {
            padding: 8px 16px; border: 1px solid var(--border-color); background: var(--surface-color);
            border-radius: var(--radius-md); cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s;
        }
        .history-tab:hover { border-color: var(--primary-color); }
        .history-tab.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
        .history-content { display: none; }
        .history-content.active { display: block; }
        .mileage-expiry-row { display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--border-color); font-size: 14px; }
        .mileage-expiry-row:last-child { border-bottom: none; }
        .mileage-expiry-month { font-weight: 600; min-width: 80px; }
        .mileage-expiry-amount { color: var(--primary-color); font-weight: 600; }
        .mileage-expiry-date { color: var(--text-secondary); font-size: 13px; }
        .mileage-expiry-empty { color: var(--text-secondary); text-align: center; padding: 24px 0; }
        .mileage-expiry-3m-desc { margin-bottom: 8px; color: var(--text-primary); font-size: 14px; }
        .mileage-expiry-3m-note { margin-bottom: 16px; font-size: 13px; color: var(--danger-color); }
        .mileage-expiry-3m-note .asterisk { color: var(--danger-color); }
        .mileage-expiry-3m-item { border-bottom: 1px solid var(--border-color); }
        .mileage-expiry-3m-item:last-child { border-bottom: none; }
        .mileage-expiry-3m-head { display: flex; align-items: center; justify-content: space-between; padding: 14px 0; cursor: pointer; }
        .mileage-expiry-3m-head-left { display: flex; flex-direction: column; gap: 2px; }
        .mileage-expiry-3m-head-right { display: flex; align-items: center; gap: 8px; }
        .mileage-expiry-3m-label { font-size: 12px; color: var(--text-secondary); }
        .mileage-expiry-3m-lastday { color: var(--text-secondary); font-weight: 500; }
        .mileage-expiry-3m-chevron { font-size: 12px; color: var(--text-secondary); transition: transform 0.2s; }
        .mileage-expiry-3m-chevron.open { transform: rotate(180deg); }
        .mileage-expiry-3m-detail { display: none; padding: 12px 0 16px; border-top: 1px solid var(--bg-color); font-size: 13px; color: var(--text-secondary); }
        .mileage-expiry-3m-detail.open { display: block; }
        .mileage-expiry-3m-detail-row { padding: 4px 0; }
        .mileage-expiry-3m-detail-section { margin-bottom: 12px; }
        .mileage-expiry-3m-detail-section:last-child { margin-bottom: 0; }
        .mileage-expiry-3m-detail-title { display: block; font-size: 12px; font-weight: 600; color: var(--text-primary); margin-bottom: 6px; }
        .mileage-expiry-3m-result .mileage-expiry-3m-detail-row { color: var(--primary-color); }
        .pagination {
            display: flex; justify-content: center; align-items: center; gap: 4px;
            margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-color);
        }
        .pagination-btn {
            min-width: 36px; height: 36px; padding: 0 12px; border: 1px solid var(--border-color);
            background: var(--surface-color); border-radius: var(--radius-md); cursor: pointer;
            font-size: 14px; font-weight: 500; color: var(--text-primary); transition: all 0.2s;
            display: flex; align-items: center; justify-content: center;
        }
        .pagination-btn:hover:not(:disabled) { border-color: var(--primary-color); color: var(--primary-color); }
        .pagination-btn.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
        .pagination-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .pagination-ellipsis { padding: 0 8px; color: var(--text-muted); }
        .pagination-info { font-size: 13px; color: var(--text-secondary); margin-left: 16px; }
        .status-badge { padding: 4px 8px; border-radius: var(--radius-sm); font-size: 12px; font-weight: 500; }
        .status-charge { background: rgba(16, 185, 129, 0.1); color: var(--success-color); }
        .status-mileage { background: rgba(37, 99, 235, 0.1); color: var(--primary-color); }
        .status-mileage_use { background: rgba(239, 68, 68, 0.1); color: var(--danger-color); }
        .status-use { background: rgba(239, 68, 68, 0.1); color: var(--danger-color); }
        .status-refund { background: rgba(100, 116, 139, 0.1); color: var(--secondary-color); }
        .amount-plus { color: var(--success-color); font-weight: 600; }
        .amount-minus { color: var(--danger-color); font-weight: 600; }

        @media (max-width: 900px) {
            .mypage-layout { grid-template-columns: 1fr; }
            .mypage-lnb { position: static; display: flex; flex-wrap: wrap; gap: 8px; padding: 12px; }
            .mypage-lnb-item { border-left: none; border-bottom: 3px solid transparent; }
            .mypage-lnb-item.active { border-left: none; border-bottom-color: var(--primary-color); }
        }
        /* 내정보/비밀번호/발신번호 패널 공통 */
        .form-section { margin-bottom: 32px; }
        .form-section-title { font-size: 18px; font-weight: 600; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 2px solid var(--border-color); }
        /* 입력+버튼 행: 버튼 오른쪽 한 줄 공통 정렬 */
        .form-input-with-btn { display: grid; grid-template-columns: 1fr 100px; gap: 8px; align-items: center; }
        .form-input-with-btn .form-input { min-width: 0; }
        .form-input-with-btn .btn { justify-self: end; white-space: nowrap; }
        .phone-verify { display: grid; grid-template-columns: 1fr 100px; gap: 8px; align-items: flex-start; }
        .phone-verify .form-input { min-width: 0; }
        .phone-verify .btn { justify-self: end; white-space: nowrap; }
        .verify-status { display: flex; align-items: center; gap: 8px; margin-top: 8px; color: var(--success-color); font-size: 12px; grid-column: 1 / -1; }
        .flex { display: flex; }
        .gap-2 { gap: 16px; }
        .mt-3 { margin-top: 24px; }
        .mb-2 { margin-bottom: 16px; }
        .status-filter { display: flex; gap: 8px; margin-bottom: 20px; }
        .status-filter-btn { padding: 8px 16px; border: 1px solid var(--border-color); background: var(--surface-color); border-radius: var(--radius-md); cursor: pointer; font-size: 14px; transition: all 0.2s; }
        .status-filter-btn:hover { border-color: var(--primary-color); }
        .status-filter-btn.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
        .badge { display: inline-flex; align-items: center; padding: 4px 8px; font-size: 12px; font-weight: 500; border-radius: var(--radius-sm); }
        .badge-success { background: rgba(16, 185, 129, 0.1); color: var(--success-color); }
        .badge-warning { background: rgba(245, 158, 11, 0.1); color: var(--warning-color); }
        .badge-danger { background: rgba(239, 68, 68, 0.1); color: var(--danger-color); }
        .flex-between { display: flex; justify-content: space-between; align-items: center; }

        /* 발신번호 등록 팝업 스타일 (mypage-caller-number.html과 동일) */
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 32px;
            position: relative;
        }
        .step-indicator::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--border-color);
            z-index: 0;
        }
        .step-item {
            position: relative;
            z-index: 1;
            text-align: center;
            flex: 1;
        }
        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--surface-color);
            border: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 8px;
            font-weight: 600;
        }
        .step-item.active .step-circle {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        .step-item.completed .step-circle {
            background: var(--success-color);
            color: white;
            border-color: var(--success-color);
        }
        .step-label {
            font-size: 12px;
            color: var(--text-secondary);
        }
        .step-item.active .step-label {
            color: var(--primary-color);
            font-weight: 600;
        }
        .file-upload-area {
            border: 2px dashed var(--border-color);
            border-radius: var(--radius-md);
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .file-upload-area:hover {
            border-color: var(--primary-color);
            background: rgba(37, 99, 235, 0.05);
        }
        .file-upload-area.drag-over {
            border-color: var(--primary-color);
            background: rgba(37, 99, 235, 0.1);
        }
        .uploaded-file {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--bg-color);
            border-radius: var(--radius-md);
            margin-top: 12px;
        }
        .number-type-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 600;
        }
        .number-type-mobile {
            background: #e3f2fd;
            color: #1976d2;
        }
        .number-type-landline {
            background: #f3e5f5;
            color: #7b1fa2;
        }
        .auth-completed {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #e8f5e9;
            color: #2e7d32;
            border-radius: var(--radius-md);
            font-size: 14px;
        }
        .auth-completed::before {
            content: '✓';
            display: inline-block;
            width: 20px;
            height: 20px;
            background: #2e7d32;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 20px;
            font-weight: bold;
        }
        .form-row-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px; }
        .form-row-2 .form-group { margin-bottom: 0; }
        .email-with-btn { display: grid; grid-template-columns: 1fr 100px; gap: 8px; align-items: center; }
        .email-with-btn .form-input { min-width: 0; }
        .email-with-btn .btn { justify-self: end; white-space: nowrap; }
        @media (max-width: 640px) { .form-row-2 { grid-template-columns: 1fr; margin-bottom: 20px; } .form-row-2 .form-group { margin-bottom: 20px; } .form-row-2 .form-group:last-child { margin-bottom: 0; } }
    </style>
</head>
<body>
    <div class="app-container">
        <script>document.write(createHeader());</script>

        <main class="main-content">
            <div class="page-header" id="pageHeader">
                <h2>마이페이지</h2>
                <p class="page-description">회원정보를 확인하고 내 정보, 비밀번호, 발신번호, 이용내역을 관리합니다</p>
            </div>

            <!-- 회원정보 (대시보드와 동일) -->
            <div class="dashboard-summary" id="dashboardSummary">
                <div class="dashboard-summary-grid">
                    <div class="dashboard-summary-item">
                        <span class="dashboard-summary-label">회원유형</span>
                        <span class="dashboard-summary-value" id="dashboardMemberType">개인회원</span>
                    </div>
                    <div class="dashboard-summary-item">
                        <span class="dashboard-summary-label">회원등급</span>
                        <span class="dashboard-summary-value" id="dashboardMemberGrade">일반</span>
                    </div>
                    <div class="dashboard-summary-item">
                        <span class="dashboard-summary-label">잔액</span>
                        <div id="dashboardBalance">
                            <div class="dashboard-summary-balance-line">
                                <div class="dashboard-summary-balance-row"><a href="payment-charge.html" class="dashboard-summary-caller-count-link" id="dashboardPointsLink" title="충전하기"><span id="dashboardPoints">1,000,000</span></a><span class="unit">포인트</span></div>
                                <div class="dashboard-summary-balance-row"><span id="dashboardMileage">92.6</span><span class="unit">마일리지</span></div>
                            </div>
                            <div class="dashboard-summary-dedicated-account" id="dashboardCallerCountSection">
                                <div class="dashboard-summary-dedicated-account-label">발신번호 등록 건수</div>
                                <div class="dashboard-summary-dedicated-account-content">
                                    <a href="mypage.html#caller" class="dashboard-summary-caller-count-link" id="dashboardCallerCountLink" title="발신번호 관리"><span id="dashboardCallerCount">3</span>건</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="dashboard-summary-item">
                        <span class="dashboard-summary-label">발송 가능 건수</span>
                        <div class="dashboard-summary-send-counts" id="dashboardSendCounts">
                            <span class="dashboard-summary-send-badge">SMS 발송 시 <span id="sendCountSms">0</span></span>
                            <span class="dashboard-summary-send-badge">LMS 발송 시 <span id="sendCountLms">0</span></span>
                            <span class="dashboard-summary-send-badge">MMS 발송 시 <span id="sendCountMms">0</span></span>
                            <span class="dashboard-summary-send-badge">알림톡 발송 시 <span id="sendCountAlimtalk">0</span></span>
                            <span class="dashboard-summary-send-badge">브랜드메시지 발송 시 <span id="sendCountBrandtalk">0</span></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- LNB + 콘텐츠 -->
            <div class="mypage-layout">
                <nav class="mypage-lnb" id="mypageLnb">
                    <button type="button" class="mypage-lnb-item active" data-panel="profile" onclick="switchMypagePanel('profile')">내 정보 수정</button>
                    <button type="button" class="mypage-lnb-item" data-panel="password" onclick="switchMypagePanel('password')">비밀번호 변경</button>
                    <button type="button" class="mypage-lnb-item" data-panel="caller" onclick="switchMypagePanel('caller')">발신번호 관리</button>
                    <button type="button" class="mypage-lnb-item" data-panel="history" onclick="switchMypagePanel('history')">포인트/마일리지 내역</button>
                    <a href="support-inquiry.html#history" class="mypage-lnb-item">내 문의 내역</a>
                </nav>

                <div class="mypage-content">
                    <!-- 내정보수정 (폼 바로 표시) -->
                    <div class="mypage-content-panel active" id="panel-profile">
                        <div class="card" id="profileCard">
                            <form id="profileForm">
                                <div class="form-section" id="basicInfoSection">
                                    <h3 class="form-section-title">기본 정보</h3>
                                    <div class="form-group">
                                        <label class="form-label">아이디</label>
                                        <input type="text" class="form-input" value="user@example.com" disabled style="background: var(--bg-color);">
                                    </div>
                                    <div class="form-row-2">
                                        <div class="form-group">
                                            <label class="form-label required">이름</label>
                                            <input type="text" class="form-input" id="profileUserName" value="홍길동" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">생년월일</label>
                                            <input type="date" class="form-input">
                                        </div>
                                    </div>
                                    <div class="form-row-2">
                                        <div class="form-group">
                                            <label class="form-label required">휴대폰번호</label>
                                            <div class="phone-verify">
                                                <input type="tel" class="form-input" value="010-1234-5678" required>
                                                <button type="button" class="btn btn-outline" onclick="openModal('phoneVerifyModal')" title="클릭 시 휴대폰 인증 모달 오픈. SMS 인증번호 발송·입력 후 인증 완료 처리.">인증</button>
                                            </div>
                                            <div class="verify-status" id="phoneVerifyStatus" style="display: none;"><span>✓</span><span>인증 완료</span></div>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label required">이메일 주소</label>
                                            <div class="flex gap-2 email-with-btn">
                                                <input type="email" class="form-input" value="user@example.com" required>
                                                <button type="button" class="btn btn-outline" onclick="checkEmail()" title="입력 이메일이 기존 회원과 중복인지 확인. 사용 가능/이미 사용 중 메시지.">중복 확인</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-section" id="addressSection">
                                    <h3 class="form-section-title">주소 정보</h3>
                                    <div class="form-group">
                                        <label class="form-label">우편번호</label>
                                        <div class="form-input-with-btn">
                                            <input type="text" class="form-input" value="12345" readonly>
                                            <button type="button" class="btn btn-outline" onclick="openAddressSearch()" title="주소 검색 클릭 시 Daum 우편번호 API 팝업. 선택 시 우편번호·주소 자동 입력.">주소 검색</button>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">주소</label>
                                        <input type="text" class="form-input" value="서울특별시 강남구 테헤란로 123" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">상세주소</label>
                                        <input type="text" class="form-input" placeholder="상세주소를 입력하세요">
                                    </div>
                                </div>
                                <div class="form-section" id="joinDateSection">
                                    <div class="form-group">
                                        <label class="form-label">회원가입일</label>
                                        <input type="text" class="form-input" value="2024-01-01" disabled style="background: var(--bg-color);">
                                    </div>
                                </div>
                                <div class="flex gap-2 mt-3" id="profileActions">
                                    <button type="submit" class="btn btn-primary" id="saveProfileBtn" title="수정 정보 검증 후 저장. 필수값·형식·인증 완료 여부 등 검증. 성공 시 안내 메시지.">저장하기</button>
                                    <button type="button" class="btn btn-outline" onclick="resetForm()" id="cancelProfileBtn" title="입력 내용 초기화, 원래 값으로 복원.">취소</button>
                                </div>
                            </form>
                        </div>
                        <div style="margin-top: 16px; display: flex; gap: 8px; align-items: center; padding: 8px 12px; background: var(--bg-color); border-radius: var(--radius-md); font-size: 13px;">
                            <span style="color: var(--text-secondary);">테스트:</span>
                            <button type="button" class="btn btn-sm btn-outline" onclick="setTestMemberType('personal')" style="padding: 4px 10px; font-size: 12px;">개인회원</button>
                            <button type="button" class="btn btn-sm btn-outline" onclick="setTestMemberType('business')" style="padding: 4px 10px; font-size: 12px;">기업회원</button>
                            <span id="currentMemberTypeDisplay" style="margin-left: 8px; color: var(--primary-color); font-weight: 600;"></span>
                        </div>
                        <div class="card" id="businessInfoCard" style="margin-top: 24px; display: none;">
                            <h3 class="card-title" style="margin-bottom: 24px;">기업 정보</h3>
                            <div class="table-container">
                                <table class="table">
                                    <tr><th style="width: 150px;">회사명(상호)</th><td>주식회사 예시</td></tr>
                                    <tr><th>사업자등록번호</th><td>123-45-67890</td></tr>
                                    <tr><th>대표자명</th><td>홍길동</td></tr>
                                    <tr>
                                        <th>사업장 주소</th>
                                        <td>
                                            <div class="form-group" style="margin-bottom: 12px;">
                                                <label class="form-label">우편번호</label>
                                                <div class="form-input-with-btn">
                                                    <input type="text" class="form-input" id="businessZipcode" value="06134" readonly style="max-width: 120px;">
                                                    <button type="button" class="btn btn-outline" onclick="openBusinessAddressSearch()" title="우편번호 검색">주소 검색</button>
                                                </div>
                                            </div>
                                            <div class="form-group" style="margin-bottom: 12px;">
                                                <label class="form-label">주소</label>
                                                <input type="text" class="form-input" id="businessAddressBase" value="서울특별시 강남구 테헤란로 123" readonly>
                                            </div>
                                            <div class="form-group" style="margin-bottom: 0;">
                                                <label class="form-label">상세주소</label>
                                                <input type="text" class="form-input" id="businessAddressDetail" placeholder="상세주소를 입력하세요" value="">
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div style="margin-top: 16px;">
                                <button type="button" class="btn btn-primary" onclick="openModal('taxAutoApplyModal')" title="기업회원 전용. 클릭 시 세금계산서 자동발행 신청 모달 오픈. 담당자 정보 입력 후 신청.">세금계산서 자동발행 신청</button>
                            </div>
                        </div>
                        <div class="card" id="memberTypeCard" style="margin-top: 24px;">
                            <div class="form-section" style="margin-bottom: 0;">
                                <h3 class="form-section-title">회원유형 전환</h3>
                                <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 20px;">현재 회원유형: <strong style="color: var(--primary-color);" id="currentMemberTypeText">개인회원</strong></p>
                                <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;">아래 회원유형으로 전환하여 추가 서비스를 이용할 수 있습니다.</p>
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                                    <div style="border: 1px solid var(--border-color); border-radius: var(--radius-md); padding: 20px; text-align: center;">
                                        <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">개인사업자 회원</div>
                                        <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;">세금계산서 발행 가능</div>
                                        <a href="mypage-convert-business.html" class="btn btn-outline btn-sm" title="개인→개인사업자 전환. 클릭 시 mypage-convert-business.html 이동.">전환 신청</a>
                                    </div>
                                    <div style="border: 1px solid var(--border-color); border-radius: var(--radius-md); padding: 20px; text-align: center;">
                                        <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">법인사업자 회원</div>
                                        <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;">세금계산서 발행 가능</div>
                                        <a href="mypage-convert-corporate.html" class="btn btn-outline btn-sm" title="개인/개인사업자→법인사업자 전환. 클릭 시 mypage-convert-corporate.html 이동.">전환 신청</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="alert alert-info" style="margin-top: 24px;">
                            <div style="display: flex; align-items: flex-start; gap: 12px;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="flex-shrink: 0; margin-top: 2px;"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                                <div style="font-size: 13px; line-height: 1.6;"><strong>메시지 발송 대행업체에 해당하는 회원일 경우</strong><br>충전 및 정산(세금계산서) 등의 분리를 위해서 위임하는 고객사별로 사업자 계정을 각각 생성하여야 합니다. 계정 생성을 원하시면 고객센터(<strong>1588-0000</strong>)로 문의 부탁 드립니다.</div>
                            </div>
                        </div>
                        <p style="margin-top: 32px; padding-top: 24px; border-top: 1px solid var(--border-color);">
                            <a href="javascript:void(0)" onclick="openWithdrawalModal()" style="font-size: 14px; color: var(--text-secondary); text-decoration: underline;" title="회원 탈퇴(해지) 절차 진입. 클릭 시 탈퇴 확인 모달 또는 탈퇴 페이지 이동.">회원 해지</a>
                            <span style="font-size: 12px; color: var(--text-muted); margin-left: 12px;">|</span>
                            <a href="javascript:void(0)" onclick="openWithdrawalModal(true)" style="font-size: 12px; color: var(--text-muted); text-decoration: underline;" title="1만 포인트 미만일 때 회원해지 팝업 예시 보기">1만 포인트 미만 회원해지 예시</a>
                        </p>
                    </div>

                    <!-- 비밀번호변경 (폼 바로 표시) -->
                    <div class="mypage-content-panel" id="panel-password">
                        <div class="card" id="passwordCard">
                            <form id="passwordForm">
                                <div class="form-group" id="currentPasswordGroup">
                                    <label class="form-label required">현재 비밀번호</label>
                                    <input type="password" class="form-input" required id="currentPassword">
                                </div>
                                <div class="form-group" id="newPasswordGroup">
                                    <label class="form-label required">새 비밀번호</label>
                                    <input type="password" class="form-input" required id="newPassword">
                                    <div class="form-help">8~16자 이내, 영문 대소문자, 숫자, 특수문자 중 3가지 이상 조합</div>
                                </div>
                                <div class="form-group" id="confirmPasswordGroup">
                                    <label class="form-label required">새 비밀번호 확인</label>
                                    <input type="password" class="form-input" required id="confirmPassword">
                                </div>
                                <div class="flex gap-2 mt-3" id="passwordActions">
                                    <button type="submit" class="btn btn-primary" id="changePasswordBtn" title="검증 후 비밀번호 변경 API 호출. 성공 시 완료 메시지 및 로그인 페이지 이동 등.">변경하기</button>
                                    <button type="button" class="btn btn-outline" onclick="resetPasswordForm()" id="cancelBtn" title="입력 초기화 또는 이전 패널/페이지로 이동.">취소</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- 발신번호관리: mypage-caller-number.html 본문 그대로 표시 (iframe 없이) -->
                    <div class="mypage-content-panel" id="panel-caller">
                        <div class="alert alert-info" id="callerNumberNotice">
                            <strong>발신번호 사전등록제 안내</strong>
                            <p style="margin-top: 8px; font-size: 12px;">
                                정보통신망법에 따라 발신번호 사전 등록이 의무화되었습니다.
                                발신번호 등록 후 영업일 기준 1~3일 이내 승인 처리됩니다.
                            </p>
                        </div>
                        <div class="alert alert-warning" id="agencyNotice" style="margin-top: 16px;">
                            <div style="display: flex; align-items: flex-start; gap: 12px;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="flex-shrink: 0; margin-top: 2px;">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="16" x2="12" y2="12"></line>
                                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                </svg>
                                <div style="font-size: 13px; line-height: 1.6;">
                                    <strong>메시지 발송 대행업체에 해당하는 회원일 경우</strong><br>
                                    충전 및 정산(세금계산서) 등의 분리를 위해서 위임하는 고객사별로 사업자 계정을 각각 생성하여야 합니다. 계정 생성을 원하시면 고객센터(<strong>1588-0000</strong>)로 문의 부탁 드립니다.
                                </div>
                            </div>
                        </div>
                        <div class="card" id="callerNumberCard">
                            <div class="flex-between mb-2">
                                <h3 class="card-title">발신번호 목록</h3>
                                <div style="display: flex; gap: 8px; align-items: center;">
                                    <div style="display: flex; gap: 4px; align-items: center; padding: 4px 8px; background: var(--bg-color); border-radius: var(--radius-md); font-size: 12px;">
                                        <span style="color: var(--text-secondary); margin-right: 4px;">테스트:</span>
                                        <button class="btn btn-sm btn-outline" onclick="setTestMemberType('personal')" style="padding: 4px 8px; font-size: 11px;">개인회원</button>
                                        <button class="btn btn-sm btn-outline" onclick="setTestMemberType('business')" style="padding: 4px 8px; font-size: 11px;">기업회원</button>
                                        <span id="callerPanelMemberTypeDisplay" style="margin-left: 8px; color: var(--primary-color); font-weight: 600;"></span>
                                    </div>
                                    <button class="btn btn-primary" onclick="openRegisterModal()" id="registerCallerBtn">발신번호 등록</button>
                                </div>
                            </div>
                            <div class="status-filter" id="statusFilter">
                                <button class="status-filter-btn active" onclick="filterStatus('all')">전체</button>
                                <button class="status-filter-btn" onclick="filterStatus('pending')">승인대기</button>
                                <button class="status-filter-btn" onclick="filterStatus('approved')">승인완료</button>
                                <button class="status-filter-btn" onclick="filterStatus('rejected')">반려</button>
                            </div>
                            <div class="table-container" id="callerNumberTableContainer">
                                <table class="table" id="callerNumberTable">
                                    <thead>
                                        <tr>
                                            <th>발신번호</th>
                                            <th>통신사</th>
                                            <th>명의</th>
                                            <th>상태</th>
                                            <th>등록일</th>
                                            <th>승인일</th>
                                            <th>관리</th>
                                        </tr>
                                    </thead>
                                    <tbody id="callerNumberTableBody">
                                        <tr data-id="1" data-status="approved">
                                            <td class="caller-number-cell" style="cursor: pointer; color: var(--primary-color); text-decoration: underline;" onclick="openEditPurposeModal(1, '010-1234-5678', '마케팅팀')" title="클릭 시 용도 수정">010-1234-5678 <span style="color: var(--text-secondary);">(마케팅팀)</span></td>
                                            <td>SKT</td>
                                            <td>본인</td>
                                            <td><span class="badge badge-success">승인완료</span></td>
                                            <td>2024-01-10</td>
                                            <td>2024-01-12</td>
                                            <td>
                                                <button class="btn btn-sm btn-outline" onclick="event.stopPropagation(); deleteCallerNumber(1)">삭제</button>
                                            </td>
                                        </tr>
                                        <tr data-id="2" data-status="pending">
                                            <td class="caller-number-cell" style="cursor: pointer; color: var(--primary-color); text-decoration: underline;" onclick="openEditPurposeModal(2, '02-1234-5678', '고객센터')" title="클릭 시 용도 수정">02-1234-5678 <span style="color: var(--text-secondary);">(고객센터)</span></td>
                                            <td>KT</td>
                                            <td>타사</td>
                                            <td><span class="badge badge-warning">승인대기</span></td>
                                            <td>2024-01-15</td>
                                            <td>-</td>
                                            <td>—</td>
                                        </tr>
                                        <tr data-id="3" data-status="rejected">
                                            <td class="caller-number-cell" style="cursor: pointer; color: var(--primary-color); text-decoration: underline;" onclick="openEditPurposeModal(3, '010-9876-5432', '본인 휴대폰')" title="클릭 시 용도 수정">010-9876-5432 <span style="color: var(--text-secondary);">(본인 휴대폰)</span></td>
                                            <td>LG U+</td>
                                            <td>본인</td>
                                            <td><span class="badge badge-danger">반려</span></td>
                                            <td>2024-01-08</td>
                                            <td>-</td>
                                            <td>
                                                <button class="btn btn-sm btn-outline" onclick="viewRejectionReason(3)">반려사유</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- 이용내역 (포인트/마일리지 내역 - 결제관리 환불 탭과 동일) -->
                    <div class="mypage-content-panel" id="panel-history">
                        <div class="card" id="historyCard">
                            <div class="card-header card-header-with-period">
                                <h3 class="card-title">포인트/마일리지 내역</h3>
                                <div class="history-period-filter">
                                    <div class="history-period-dates">
                                        <input type="date" id="historyDateFrom" class="form-input input-sm" title="달력으로 조회 시작일 선택. 과거 데이터 검색용. 선택 구간은 최대 1년.">
                                        <span class="history-period-sep">~</span>
                                        <input type="date" id="historyDateTo" class="form-input input-sm" title="달력으로 조회 종료일 선택. 과거 데이터 검색용. 시작일~종료일 최대 1년.">
                                    </div>
                                    <div class="history-period-btns">
                                        <button type="button" class="btn btn-outline btn-sm" onclick="applyHistoryPeriod('1')" title="최근 기준: 오늘부터 과거 1개월 구간 자동 설정 후 내역 조회.">1개월</button>
                                        <button type="button" class="btn btn-outline btn-sm" onclick="applyHistoryPeriod('3')" title="최근 기준: 오늘부터 과거 3개월 구간 자동 설정 후 내역 조회.">3개월</button>
                                        <button type="button" class="btn btn-outline btn-sm" onclick="applyHistoryPeriod('6')" title="최근 기준: 오늘부터 과거 6개월 구간 자동 설정 후 내역 조회.">6개월</button>
                                        <button type="button" class="btn btn-outline btn-sm" onclick="applyHistoryPeriod('12')" title="최근 기준: 오늘부터 과거 1년 구간 자동 설정 후 내역 조회.">1년</button>
                                    </div>
                                    <button type="button" class="btn btn-primary btn-sm" id="historySearchBtn" onclick="applyHistoryPeriod('custom')">검색</button>
                                </div>
                            </div>
                            <p class="form-help" style="margin: -8px 0 12px 0; font-size: 12px; color: var(--text-secondary);">※ 기간 버튼(1/3/6개월, 1년)은 <strong>최근 기준</strong> 조회, 달력+검색은 <strong>과거 구간 직접 선택</strong> 조회(최대 1년)</p>
                            <div class="history-tabs" id="historyTabs">
                                <button type="button" class="history-tab active" onclick="switchHistoryTab('charge')" title="포인트 충전 내역 탭 선택. 날짜·결제수단·금액·잔액 등 표시.">포인트 충전 내역</button>
                                <button type="button" class="history-tab" onclick="switchHistoryTab('use')" title="포인트 사용 내역 탭 선택. 날짜·서비스·발송 건수·금액·잔액 등 표시.">포인트 사용 내역</button>
                                <button type="button" class="history-tab" onclick="switchHistoryTab('mileage')" title="마일리지 적립·사용 내역 탭 선택.">마일리지 적립/사용 내역</button>
                                <div class="history-tabs-right">
                                    <button type="button" class="btn btn-outline btn-sm" onclick="openMileageExpiryByMonthModal()" title="클릭 시 소멸 예정 마일리지 모달 오픈. 당월 포함 3개월 소멸 예정 내역 표시.">소멸 예정 마일리지</button>
                                </div>
                            </div>
                            <div class="history-content active" id="historyCharge">
                                <div class="table-container">
                                    <table class="table" title="충전 일시·결제수단·금액·잔액 목록. 페이지네이션 포함.">
                                        <thead>
                                            <tr>
                                                <th>날짜</th>
                                                <th>결제수단</th>
                                                <th>금액</th>
                                                <th>잔액</th>
                                            </tr>
                                        </thead>
                                        <tbody id="historyChargeBody"></tbody>
                                    </table>
                                </div>
                                <div class="pagination" id="paginationCharge"></div>
                            </div>
                            <div class="history-content" id="historyMileage">
                                <div class="table-container">
                                    <table class="table" title="일시·구분·내용·금액·잔액 목록. 페이지네이션 포함.">
                                        <thead>
                                            <tr>
                                                <th>날짜</th>
                                                <th>구분</th>
                                                <th>내용</th>
                                                <th>금액</th>
                                                <th>잔액</th>
                                            </tr>
                                        </thead>
                                        <tbody id="historyMileageBody"></tbody>
                                    </table>
                                </div>
                                <div class="pagination" id="paginationMileage"></div>
                            </div>
                            <div class="history-content" id="historyUse">
                                <div class="table-container">
                                    <table class="table" title="사용 일시·서비스·발송 건수·금액·잔액 목록. 페이지네이션 포함.">
                                        <thead>
                                            <tr>
                                                <th>날짜</th>
                                                <th>서비스</th>
                                                <th>발송 건수</th>
                                                <th>금액</th>
                                                <th>잔액</th>
                                            </tr>
                                        </thead>
                                        <tbody id="historyUseBody"></tbody>
                                    </table>
                                </div>
                                <div class="pagination" id="paginationUse"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 휴대폰 인증 모달 -->
    <div class="modal-overlay" id="phoneVerifyModal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">휴대폰 인증</h3>
                <button class="modal-close" onclick="closeModal('phoneVerifyModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">휴대폰번호</label>
                    <input type="tel" class="form-input" value="010-XXXX-1234" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">인증번호</label>
                    <input type="text" class="form-input" placeholder="6자리 인증번호를 입력하세요" maxlength="6">
                    <div class="form-help">인증번호가 발송되었습니다. (유효시간: 3분)</div>
                    <button type="button" class="btn btn-sm btn-outline mt-1">재전송</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('phoneVerifyModal')">취소</button>
                <button class="btn btn-primary" onclick="verifyPhoneMypage()">확인</button>
            </div>
        </div>
    </div>
    <!-- 소멸 예정 마일리지 (당월 포함 3개월) 모달 -->
    <div class="modal-overlay" id="mileageExpiryByMonthModal" style="display: none;">
        <div class="modal" style="max-width: 440px;">
            <div class="modal-header">
                <h3 class="modal-title">소멸 예정 마일리지</h3>
                <button class="modal-close" onclick="closeMileageExpiryByMonthModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p class="mileage-expiry-3m-desc">이후 3개월(당월포함)동안의 소멸예정 마일리지 내역입니다.</p>
                <p class="mileage-expiry-3m-note"><span class="asterisk">*</span> 사용 또는 사용취소한 마일리지는 익일 소멸 예정 마일리지에 반영됩니다.</p>
                <div id="mileageExpiryByMonthBody"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeMileageExpiryByMonthModal()">확인</button>
            </div>
        </div>
    </div>
    <!-- 세금계산서 자동발행 신청 모달 -->
    <div class="modal-overlay" id="taxAutoApplyModal" style="display: none;">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title">세금계산서 자동발행 신청</h3>
                <button class="modal-close" onclick="closeModal('taxAutoApplyModal')">&times;</button>
            </div>
            <div class="modal-body">
                <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;">세금계산서 담당자 정보를 입력 후 신청해 주세요.</p>
                <div class="form-group">
                    <label class="form-label required">담당자 이름</label>
                    <input type="text" class="form-input" id="taxManagerName" value="홍길동" placeholder="담당자 이름">
                </div>
                <div class="form-group">
                    <label class="form-label required">담당자 연락처</label>
                    <input type="text" class="form-input" id="taxManagerPhone" value="010-1234-5678" placeholder="010-0000-0000">
                </div>
                <div class="form-group">
                    <label class="form-label required">수신 이메일</label>
                    <input type="email" class="form-input" id="taxManagerEmail" value="example@company.com" placeholder="세금계산서 수신 이메일">
                    <div class="form-help">세금계산서가 발행되면 이메일로 자동 발송됩니다</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('taxAutoApplyModal')">취소</button>
                <button class="btn btn-primary" onclick="submitTaxAutoApplyMypage()">신청</button>
            </div>
        </div>
    </div>

    <!-- 회원 해지 1단계: 안내 + 포인트/마일리지 + 다음 -->
    <div class="modal-overlay" id="withdrawalConfirmModal" style="display: none;">
        <div class="modal" style="max-width: 440px;">
            <div class="modal-header">
                <h3 class="modal-title">회원 해지</h3>
                <button class="modal-close" onclick="closeModal('withdrawalConfirmModal')">&times;</button>
            </div>
            <div class="modal-body">
                <p style="font-size: 16px; font-weight: 600; margin-bottom: 12px; color: var(--text-primary);" id="withdrawalConfirmGreeting">홍길동님, 잠시만요!</p>
                <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 24px; line-height: 1.6;" id="withdrawalConfirmMessage">해지하시면 고객님의 소중한 정보와 혜택이 모두 소멸됩니다.</p>
                <div id="withdrawalConfirmBalanceBox" style="background: var(--bg-color); border-radius: var(--radius-md); padding: 16px; margin-bottom: 24px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <span style="font-size: 14px; color: var(--text-secondary);">잔여 포인트</span>
                        <span style="font-size: 15px; font-weight: 600;" id="withdrawalConfirmPoints">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 14px; color: var(--text-secondary);">잔여 마일리지</span>
                        <span style="font-size: 15px; font-weight: 600;" id="withdrawalConfirmMileage">0</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="withdrawalConfirmCancelBtn" onclick="closeModal('withdrawalConfirmModal')">취소</button>
                <button class="btn btn-primary" id="withdrawalConfirmPrimaryBtn" onclick="nextToWithdrawalAuth()">다음</button>
            </div>
        </div>
    </div>

    <!-- 회원 해지 2단계: 본인 명의 휴대폰 인증 -->
    <div class="modal-overlay" id="withdrawalAuthModal" style="display: none;">
        <div class="modal" style="max-width: 440px;">
            <div class="modal-header">
                <h3 class="modal-title">본인 명의 휴대폰 인증</h3>
                <button class="modal-close" onclick="closeModal('withdrawalAuthModal')">&times;</button>
            </div>
            <div class="modal-body">
                <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 20px;">회원 해지를 위해 본인 명의 휴대폰 인증이 필요합니다.</p>
                <div class="form-group">
                    <label class="form-label required">휴대폰번호</label>
                    <input type="tel" id="withdrawalAuthPhone" class="form-input" placeholder="010-1234-5678" value="010-1234-5678">
                </div>
                <div class="form-group">
                    <label class="form-label required">인증번호</label>
                    <input type="text" id="withdrawalAuthCode" class="form-input" placeholder="6자리 인증번호 입력" maxlength="6">
                    <div class="form-help">인증번호가 발송되었습니다. (유효시간: 3분)</div>
                    <button type="button" class="btn btn-sm btn-outline mt-1" onclick="resendWithdrawalAuthCode()">재전송</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeWithdrawalAuth()">취소</button>
                <button class="btn btn-primary" onclick="submitWithdrawalAuth()">인증하기</button>
            </div>
        </div>
    </div>

    <!-- 발신번호 등록/상세/용도수정 모달 (발신번호관리 패널용) -->
    <div class="modal-overlay" id="registerModal" style="display: none;">
        <div class="modal" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h3 class="modal-title">발신번호 신규등록</h3>
                <button class="modal-close" onclick="closeModal('registerModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 24px; padding: 12px; background: var(--bg-color); border-radius: var(--radius-md);">
                    <strong>발신번호 등록 문의: 1588-5412</strong><br>
                    <small>기존 번호 관리는 발신번호관리 메뉴에서 가능합니다</small>
                </div>
                <div class="step-indicator">
                    <div class="step-item active" id="step1">
                        <div class="step-circle">1</div>
                        <div class="step-label">기본 정보</div>
                    </div>
                    <div class="step-item" id="step2">
                        <div class="step-circle">2</div>
                        <div class="step-label">인증 및 서류</div>
                    </div>
                    <div class="step-item" id="step3">
                        <div class="step-circle">3</div>
                        <div class="step-label">연락처</div>
                    </div>
                    <div class="step-item" id="step4">
                        <div class="step-circle">4</div>
                        <div class="step-label">제출</div>
                    </div>
                </div>
                <form id="registerForm">
                    <div id="step1Content" class="step-content">
                        <h3 style="margin-bottom: 20px;">기본 정보 입력</h3>
                        <div class="form-group">
                            <label class="form-label required">발신번호 등록</label>
                            <div class="flex gap-2">
                                <input type="tel" id="callerNumberInput" class="form-input" placeholder="010-1234-5678 또는 02-1234-5678" required oninput="detectNumberType()">
                                <button type="button" class="btn btn-outline" onclick="checkDuplicateNumber()">확인</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">발신번호 용도</label>
                            <input type="text" id="purposeInput" class="form-input" placeholder="예: 마케팅팀, 고객센터, 본인 휴대폰">
                        </div>
                    </div>
                    <div id="step2Content" class="step-content" style="display: none;">
                        <h3 style="margin-bottom: 20px;">명의 구분 및 서류 제출</h3>
                        <div class="form-group">
                            <label class="form-label required">명의 구분</label>
                            <div id="ownershipTypeSection"></div>
                        </div>
                        <div class="form-group" id="authSection" style="display: none;">
                            <label class="form-label required">본인인증</label>
                            <div id="authStatus" style="margin-bottom: 8px;">
                                <button type="button" class="btn btn-primary" id="authButton" onclick="openPhoneAuth()">휴대폰 본인인증</button>
                            </div>
                            <div class="form-help" id="authHelpText">발신번호 명의자 본인인증이 필요합니다</div>
                        </div>
                        <div class="form-group" id="documentSection"></div>
                    </div>
                    <div id="step3Content" class="step-content" style="display: none;">
                        <h3 style="margin-bottom: 20px;">연락처 정보</h3>
                        <div class="form-group">
                            <label class="form-label required">휴대폰번호</label>
                            <input type="tel" id="contactPhoneInput" class="form-input" placeholder="010-1234-5678" required>
                            <div class="form-help">승인/반려 결과 알림을 받을 연락처입니다</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">결과 수신 이메일</label>
                            <input type="email" id="contactEmailInput" class="form-input" placeholder="example@email.com">
                            <div class="form-help">발신번호 등록 결과를 이메일로도 받으시려면 입력해 주세요</div>
                        </div>
                    </div>
                    <div id="step4Content" class="step-content" style="display: none;">
                        <h3 style="margin-bottom: 20px;">최종 확인</h3>
                        <div class="alert alert-info">모든 정보를 확인하신 후 제출해주세요. 제출 후 수정이 불가능합니다.</div>
                        <div class="card">
                            <div class="table-container">
                                <table class="table">
                                    <tr><th style="width: 150px;">회원 유형</th><td id="reviewMemberType">-</td></tr>
                                    <tr><th>발신번호</th><td id="reviewCallerNumber">-</td></tr>
                                    <tr><th>번호 유형</th><td id="reviewNumberType">-</td></tr>
                                    <tr><th>명의 구분</th><td id="reviewOwnershipType">-</td></tr>
                                    <tr><th>용도</th><td id="reviewPurpose">-</td></tr>
                                    <tr id="reviewBusinessAddressRow" style="display: none;"><th>사업장 주소</th><td id="reviewBusinessAddress">-</td></tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('registerModal')">취소</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextStep()" style="display: none;">다음</button>
                <button class="btn btn-primary" id="submitBtn" onclick="submitRegister()" style="display: none;">승인요청</button>
            </div>
        </div>
    </div>
    <div class="modal-overlay" id="detailModal" style="display: none;">
        <div class="modal" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h3 class="modal-title">발신번호 상세 정보</h3>
                <button class="modal-close" onclick="closeModal('detailModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="card" style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 16px; font-size: 16px; font-weight: 600;">기본 정보</h4>
                    <div class="table-container">
                        <table class="table">
                            <tr><th style="width: 150px;">발신번호</th><td id="detailCallerNumber">-</td></tr>
                            <tr><th>통신사</th><td id="detailCarrier">-</td></tr>
                            <tr><th>용도</th><td id="detailPurpose">-</td></tr>
                            <tr><th>상태</th><td id="detailStatus">-</td></tr>
                            <tr><th>등록일</th><td id="detailRegisterDate">-</td></tr>
                            <tr><th>승인일</th><td id="detailApproveDate">-</td></tr>
                        </table>
                    </div>
                </div>
                <div class="card" style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 16px; font-size: 16px; font-weight: 600;">신청 정보</h4>
                    <div class="table-container">
                        <table class="table">
                            <tr><th style="width: 150px;">회원 유형</th><td id="detailMemberType">-</td></tr>
                            <tr><th>명의 구분</th><td id="detailOwnershipType">-</td></tr>
                            <tr><th>번호 유형</th><td id="detailNumberType">-</td></tr>
                        </table>
                    </div>
                </div>
                <div class="card" style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 16px; font-size: 16px; font-weight: 600;">연락처 정보</h4>
                    <div class="table-container">
                        <table class="table">
                            <tr><th style="width: 150px;">결과 수신 휴대폰</th><td id="detailContactPhone">-</td></tr>
                            <tr><th>결과 수신 이메일</th><td id="detailContactEmail">-</td></tr>
                        </table>
                    </div>
                </div>
                <div class="card" id="detailDocumentSection" style="display: none;">
                    <h4 style="margin-bottom: 16px; font-size: 16px; font-weight: 600;">제출 서류</h4>
                    <div id="detailDocumentList"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('detailModal')">닫기</button>
            </div>
        </div>
    </div>
    <div class="modal-overlay" id="editPurposeModal" style="display: none;">
        <div class="modal" style="max-width: 440px;">
            <div class="modal-header">
                <h3 class="modal-title">발신번호 용도 수정</h3>
                <button class="modal-close" onclick="closeModal('editPurposeModal')">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 12px; font-size: 14px; color: var(--text-secondary);"><strong id="editPurposeModalNumber">-</strong></p>
                <div class="form-group">
                    <label class="form-label required">용도</label>
                    <input type="text" id="editPurposeInput" class="form-input" placeholder="예: 마케팅팀, 고객센터" maxlength="50">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('editPurposeModal')">취소</button>
                <button class="btn btn-primary" onclick="saveCallerPurpose()">저장</button>
            </div>
        </div>
    </div>

    <script src="js/common.js"></script>
    <script src="js/caller-number-panel.js"></script>
    <script>
        // 모달 (마이페이지 내 패널용)
        function openModal(modalId) {
            var modal = document.getElementById(modalId);
            if (modal) { modal.style.display = 'flex'; modal.classList.add('active'); document.body.style.overflow = 'hidden'; }
        }
        function closeModal(modalId) {
            var modal = document.getElementById(modalId);
            if (modal) { modal.classList.remove('active'); modal.style.display = 'none'; document.body.style.overflow = ''; }
        }
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                var m = document.querySelector('.modal-overlay.active');
                if (m && m.id) closeModal(m.id);
            }
        });
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal-overlay')) { e.target.style.display = 'none'; document.body.style.overflow = ''; }
        });
        // 내정보수정: 회원유형 테스트·표시
        function setTestMemberType(type) {
            try { localStorage.setItem('memberType', type); } catch (e) {}
            updateMemberTypeDisplay();
            if (typeof showToast === 'function') showToast('회원 유형이 ' + (type === 'business' ? '기업회원' : '개인회원') + '으로 설정되었습니다.', 'success');
        }
        function updateMemberTypeDisplay() {
            var type = (typeof localStorage !== 'undefined' && localStorage.getItem('memberType')) || 'personal';
            var typeText = type === 'business' ? '기업회원' : '개인회원';
            var display = document.getElementById('currentMemberTypeDisplay');
            var textEl = document.getElementById('currentMemberTypeText');
            var dashboardMemberTypeEl = document.getElementById('dashboardMemberType');
            var callerPanelDisplay = document.getElementById('callerPanelMemberTypeDisplay');
            var businessCard = document.getElementById('businessInfoCard');
            var memberTypeCard = document.getElementById('memberTypeCard');
            if (display) display.textContent = typeText;
            if (textEl) textEl.textContent = typeText;
            if (dashboardMemberTypeEl) dashboardMemberTypeEl.textContent = typeText;
            if (callerPanelDisplay) callerPanelDisplay.textContent = typeText;
            if (businessCard) businessCard.style.display = type === 'business' ? 'block' : 'none';
            if (memberTypeCard) memberTypeCard.style.display = type === 'business' ? 'none' : 'block';
        }
        function checkEmail() { if (typeof showToast === 'function') showToast('사용 가능한 이메일입니다.', 'success'); }
        function openAddressSearch() { if (typeof showToast === 'function') showToast('주소 검색 창을 엽니다.', 'info'); }
        function openBusinessAddressSearch() { if (typeof showToast === 'function') showToast('주소 검색 창을 엽니다. 선택 시 우편번호·주소가 자동 입력됩니다.', 'info'); var z = document.getElementById('businessZipcode'); var b = document.getElementById('businessAddressBase'); if (z) z.value = '06134'; if (b) b.value = '서울특별시 강남구 테헤란로 123'; }
        function resetForm() { if (confirm('변경사항을 취소하시겠습니까?')) document.getElementById('profileForm').reset(); }
        function verifyPhoneMypage() { document.getElementById('phoneVerifyStatus').style.display = 'flex'; closeModal('phoneVerifyModal'); if (typeof showToast === 'function') showToast('인증이 완료되었습니다.', 'success'); }
        function submitTaxAutoApplyMypage() { closeModal('taxAutoApplyModal'); if (typeof showToast === 'function') showToast('세금계산서 자동발행 신청이 접수되었습니다.', 'success'); }
        document.getElementById('profileForm').addEventListener('submit', function(e) { e.preventDefault(); if (typeof showToast === 'function') showToast('저장되었습니다.', 'success'); });
        // 회원 해지 (잔여 포인트에 따라 안내 문구·버튼 분기). forceLowPoints: true 시 1만 포인트 미만 팝업 표시(예시 확인용)
        function openWithdrawalModal(forceLowPoints) {
            var nameEl = document.getElementById('profileUserName');
            var name = (nameEl && nameEl.value) ? nameEl.value.trim() : '고객';
            document.getElementById('withdrawalConfirmGreeting').textContent = name + '님, 잠시만요!';
            var pointsEl = document.getElementById('dashboardPoints');
            var mileageEl = document.getElementById('dashboardMileage');
            var pointsStr = (pointsEl ? pointsEl.textContent : '0').replace(/,/g, '').trim();
            var pointsNum = parseInt(pointsStr, 10) || 0;
            if (forceLowPoints) pointsNum = 0;
            var mileageStr = (mileageEl ? mileageEl.textContent : '0').replace(/,/g, '').trim();
            document.getElementById('withdrawalConfirmPoints').textContent = (pointsEl ? pointsEl.textContent : '0') + ' P';
            document.getElementById('withdrawalConfirmMileage').textContent = (mileageEl ? mileageEl.textContent : '0') + ' M';
            var balanceBox = document.getElementById('withdrawalConfirmBalanceBox');
            var messageEl = document.getElementById('withdrawalConfirmMessage');
            var cancelBtn = document.getElementById('withdrawalConfirmCancelBtn');
            var primaryBtn = document.getElementById('withdrawalConfirmPrimaryBtn');
            if (pointsNum >= 10000) {
                messageEl.textContent = '아직 사용하지 않은 포인트가 남아있습니다. 환불을 진행해주세요.';
                if (balanceBox) balanceBox.style.display = 'block';
                cancelBtn.textContent = '취소';
                cancelBtn.onclick = function() { closeModal('withdrawalConfirmModal'); };
                primaryBtn.textContent = '환불 진행';
                primaryBtn.onclick = function() {
                    closeModal('withdrawalConfirmModal');
                    window.location.href = 'support-inquiry.html#refund';
                };
            } else {
                messageEl.textContent = '해지하시면 고객님의 소중한 정보와 혜택이 모두 소멸됩니다. 탈퇴하시겠습니까?';
                if (balanceBox) balanceBox.style.display = 'none';
                cancelBtn.textContent = '아니오';
                cancelBtn.onclick = function() { closeModal('withdrawalConfirmModal'); };
                primaryBtn.textContent = '예';
                primaryBtn.onclick = function() { nextToWithdrawalAuth(); };
            }
            openModal('withdrawalConfirmModal');
        }
        function nextToWithdrawalAuth() {
            closeModal('withdrawalConfirmModal');
            openModal('withdrawalAuthModal');
        }
        function closeWithdrawalAuth() {
            closeModal('withdrawalAuthModal');
        }
        function resendWithdrawalAuthCode() {
            if (typeof showToast === 'function') showToast('인증번호가 재전송되었습니다.', 'info');
        }
        function submitWithdrawalAuth() {
            var code = document.getElementById('withdrawalAuthCode');
            if (!code || !code.value.trim()) {
                if (typeof showToast === 'function') showToast('인증번호를 입력해 주세요.', 'info');
                return;
            }
            closeModal('withdrawalAuthModal');
            if (typeof showToast === 'function') showToast('인증이 완료되었습니다. 회원 해지가 처리됩니다.', 'success');
        }
        // 비밀번호변경
        function showToast(message, type) {
            var toast = document.createElement('div');
            toast.style.cssText = 'position:fixed;top:20px;right:20px;padding:16px 24px;background:var(--surface-color);border:1px solid var(--border-color);border-radius:8px;box-shadow:0 10px 40px rgba(0,0,0,0.15);z-index:2000;font-size:14px;';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(function() { toast.remove(); }, 3000);
        }
        function resetPasswordForm() { if (confirm('변경사항을 취소하시겠습니까?')) document.getElementById('passwordForm').reset(); }
        document.getElementById('passwordForm').addEventListener('submit', function(e) { e.preventDefault(); showToast('비밀번호가 변경되었습니다.', 'success'); });

        // LNB 패널 전환 (클릭 시 URL 해시도 해당 패널로 변경)
        function switchMypagePanel(panelId) {
            document.querySelectorAll('.mypage-lnb-item').forEach(function(el) {
                el.classList.toggle('active', el.getAttribute('data-panel') === panelId);
            });
            document.querySelectorAll('.mypage-content-panel').forEach(function(el) {
                el.classList.toggle('active', el.id === 'panel-' + panelId);
            });
            if (panelId === 'history') {
                renderTable('charge');
            }
            // URL 해시를 패널과 동기화 (mypage.html#profile, #password, #caller, #history)
            try {
                history.replaceState(null, '', '#' + panelId);
            } catch (e) {
                location.hash = panelId;
            }
        }

        // 대시보드 요약: 회원유형 (localStorage와 동기화)
        (function syncDashboardSummary() {
            var memberTypeEl = document.getElementById('dashboardMemberType');
            if (memberTypeEl) {
                var memberType = (typeof localStorage !== 'undefined' && localStorage.getItem('memberType')) || 'personal';
                var typeText = { personal: '개인회원', business: '기업회원', election: '선거회원' }[memberType] || '개인회원';
                memberTypeEl.textContent = typeText;
            }
        })();

        // 이용내역: payment-refund와 동일 데이터·렌더링
        var ITEMS_PER_PAGE = 20;
        var currentPages = { all: 1, charge: 1, mileage: 1, use: 1 };
        var allHistoryData = [
            { date: '2024-03-05 11:00', type: 'mileage', typeLabel: '마일리지', content: '발송 마일리지 적립', amount: '+15.5', balance: '99.5' },
            { date: '2024-03-18 16:30', type: 'mileage', typeLabel: '마일리지', content: '이벤트 마일리지 적립', amount: '+10.0', balance: '84.0' },
            { date: '2024-04-01 10:00', type: 'mileage', typeLabel: '마일리지', content: '발송 마일리지 적립', amount: '+20.0', balance: '74.0' },
            { date: '2024-04-12 09:15', type: 'mileage', typeLabel: '마일리지', content: '발송 마일리지 적립', amount: '+7.0', balance: '54.0' },
            { date: '2024-11-19 14:30', type: 'charge', typeLabel: '충전', content: '포인트 충전 (신용카드)', amount: '+100,000', balance: '1,000,000' },
            { date: '2024-11-18 16:20', type: 'use', typeLabel: '사용', content: 'SMS 발송 (500건)', amount: '-10,000', balance: '900,000' },
            { date: '2024-11-18 10:15', type: 'mileage', typeLabel: '마일리지', content: '발송 마일리지 적립', amount: '+12.6', balance: '92.6' },
            { date: '2024-11-18 09:00', type: 'mileage_use', typeLabel: '마일리지 사용', content: 'SMS 발송 마일리지 사용', amount: '-2.0', balance: '80.0' },
            { date: '2024-11-17 15:00', type: 'use', typeLabel: '사용', content: 'LMS 발송 (300건)', amount: '-15,000', balance: '910,000' },
            { date: '2024-11-17 14:30', type: 'mileage', typeLabel: '마일리지', content: '발송 마일리지 적립', amount: '+15.0', balance: '82.0' },
            { date: '2024-11-16 11:00', type: 'use', typeLabel: '사용', content: 'SMS 발송 (800건)', amount: '-16,000', balance: '925,000' },
            { date: '2024-11-16 10:00', type: 'mileage', typeLabel: '마일리지', content: '발송 마일리지 적립', amount: '+16.0', balance: '67.0' },
            { date: '2024-11-16 08:30', type: 'mileage_use', typeLabel: '마일리지 사용', content: 'LMS 발송 마일리지 사용', amount: '-5.0', balance: '51.0' },
            { date: '2024-11-15 09:15', type: 'charge', typeLabel: '충전', content: '포인트 충전 (실시간계좌이체)', amount: '+200,000', balance: '941,000' },
            { date: '2024-11-14 11:30', type: 'use', typeLabel: '사용', content: '알림톡 발송 (1,000건)', amount: '-30,000', balance: '741,000' },
            { date: '2024-11-14 11:30', type: 'mileage', typeLabel: '마일리지', content: '발송 마일리지 적립', amount: '+30.0', balance: '56.0' },
            { date: '2024-11-13 16:00', type: 'use', typeLabel: '사용', content: 'SMS 발송 (200건)', amount: '-4,000', balance: '771,000' },
            { date: '2024-11-13 15:00', type: 'use', typeLabel: '사용', content: 'LMS 발송 (150건)', amount: '-7,500', balance: '775,000' },
            { date: '2024-11-13 11:00', type: 'mileage_use', typeLabel: '마일리지 사용', content: 'SMS 발송 마일리지 사용', amount: '-3.0', balance: '26.0' },
            { date: '2024-11-12 10:00', type: 'mileage', typeLabel: '마일리지', content: '발송 마일리지 적립', amount: '+4.0', balance: '29.0' },
            { date: '2024-11-12 09:00', type: 'use', typeLabel: '사용', content: 'MMS 발송 (50건)', amount: '-5,000', balance: '782,500' },
            { date: '2024-11-11 14:30', type: 'use', typeLabel: '사용', content: 'SMS 발송 (250건)', amount: '-5,000', balance: '787,500' },
            { date: '2024-11-11 10:00', type: 'mileage', typeLabel: '마일리지', content: '발송 마일리지 적립', amount: '+5.0', balance: '28.0' },
            { date: '2024-11-10 16:45', type: 'charge', typeLabel: '충전', content: '포인트 충전 (가상계좌)', amount: '+300,000', balance: '792,500' },
            { date: '2024-11-10 11:00', type: 'use', typeLabel: '사용', content: '알림톡 발송 (300건)', amount: '-9,000', balance: '492,500' },
            { date: '2024-11-09 14:20', type: 'use', typeLabel: '사용', content: 'MMS 발송 (100건)', amount: '-10,000', balance: '501,500' },
            { date: '2024-11-09 10:00', type: 'mileage', typeLabel: '마일리지', content: '발송 마일리지 적립', amount: '+10.0', balance: '23.0' },
        ];
        var chargeHistoryData = allHistoryData.filter(function(item) { return item.type === 'charge'; });
        var mileageHistoryData = allHistoryData.filter(function(item) { return item.type === 'mileage' || item.type === 'mileage_use'; });
        var useHistoryData = allHistoryData.filter(function(item) { return item.type === 'use' || item.type === 'refund'; });

        function getMileageExpiryMonthKey(dateStr) {
            var d = new Date(dateStr.replace(' ', 'T'));
            if (isNaN(d.getTime())) return null;
            d.setFullYear(d.getFullYear() + 1);
            return d.getFullYear() + '-' + ('0' + (d.getMonth() + 1)).slice(-2);
        }
        function getMileageExpiryLastDay(dateStr) {
            var d = new Date(dateStr.replace(' ', 'T'));
            if (isNaN(d.getTime())) return null;
            d.setFullYear(d.getFullYear() + 1);
            d.setMonth(d.getMonth() + 1, 0);
            return d.getFullYear() + '-' + ('0' + (d.getMonth() + 1)).slice(-2) + '-' + ('0' + d.getDate()).slice(-2);
        }
        function getMonthLastDayShort(monthKey) {
            var parts = monthKey.split('-');
            var y = parseInt(parts[0], 10), m = parseInt(parts[1], 10) - 1;
            var d = new Date(y, m + 1, 0);
            return d.getMonth() + 1 + '.' + ('0' + d.getDate()).slice(-2);
        }
        function openMileageExpiryByMonthModal() {
            var expiryEntries = [];
            mileageHistoryData.forEach(function(item) {
                if (item.type !== 'mileage') return;
                var key = getMileageExpiryMonthKey(item.date);
                if (!key) return;
                var amt = parseFloat(String(item.amount).replace(/[+,]/g, '')) || 0;
                expiryEntries.push({ key: key, amount: amt, date: item.date, content: item.content });
            });
            expiryEntries.sort(function(a, b) {
                if (a.key !== b.key) return a.key < b.key ? -1 : 1;
                return a.date < b.date ? -1 : 1;
            });
            var usages = [];
            mileageHistoryData.forEach(function(item) {
                if (item.type !== 'mileage_use') return;
                var amt = Math.abs(parseFloat(String(item.amount).replace(/[+,]/g, '')) || 0);
                usages.push({ date: item.date, amount: amt, content: item.content });
            });
            usages.sort(function(a, b) { return a.date < b.date ? -1 : 1; });
            var remaining = expiryEntries.map(function(e) { return { key: e.key, amount: e.amount, date: e.date, content: e.content }; });
            var deductionsByKey = {};
            usages.forEach(function(use) {
                var toDeduct = use.amount;
                for (var i = 0; i < remaining.length && toDeduct > 0; i++) {
                    if (remaining[i].amount <= 0) continue;
                    var take = Math.min(remaining[i].amount, toDeduct);
                    remaining[i].amount -= take;
                    toDeduct -= take;
                    var k = remaining[i].key;
                    if (!deductionsByKey[k]) deductionsByKey[k] = [];
                    deductionsByKey[k].push({ date: use.date, amount: take, content: use.content });
                }
            });
            var originalByKey = {};
            expiryEntries.forEach(function(e) {
                if (!originalByKey[e.key]) originalByKey[e.key] = [];
                originalByKey[e.key].push({ date: e.date, content: e.content, amount: e.amount });
            });
            var mergeDeductions = function(list) {
                var map = {};
                list.forEach(function(d) {
                    var id = d.date + '|' + d.content;
                    if (!map[id]) map[id] = { date: d.date, content: d.content, amount: 0 };
                    map[id].amount += d.amount;
                });
                return Object.keys(map).map(function(id) { return map[id]; });
            };
            var byMonth = {};
            remaining.forEach(function(r) {
                if (!byMonth[r.key]) byMonth[r.key] = { amount: 0, originalItems: originalByKey[r.key] || [], deductions: mergeDeductions(deductionsByKey[r.key] || []) };
                byMonth[r.key].amount += r.amount;
            });
            var refDate = new Date(2025, 1, 1);
            var threeMonths = [];
            for (var i = 0; i < 3; i++) {
                var y = refDate.getFullYear();
                var m = refDate.getMonth() + i;
                if (m > 11) { y += 1; m -= 12; }
                threeMonths.push(y + '-' + ('0' + (m + 1)).slice(-2));
            }
            var listHtml = '';
            threeMonths.forEach(function(key, idx) {
                var v = byMonth[key] || { amount: 0, originalItems: [], deductions: [] };
                var label = key.replace('-', '년 ') + '월';
                var lastDayShort = getMonthLastDayShort(key);
                var amountStr = v.amount === 0 ? '0' : v.amount.toFixed(1);
                var detailRows = '';
                detailRows += '<div class="mileage-expiry-3m-detail-section"><span class="mileage-expiry-3m-detail-title">적립 내역</span>';
                if (v.originalItems && v.originalItems.length) {
                    v.originalItems.forEach(function(it) {
                        detailRows += '<div class="mileage-expiry-3m-detail-row">' + it.date + ' ' + it.content + ' <span class="amount-plus">+' + it.amount.toFixed(1) + ' M</span></div>';
                    });
                } else {
                    detailRows += '<div class="mileage-expiry-3m-detail-row">없음</div>';
                }
                detailRows += '</div><div class="mileage-expiry-3m-detail-section"><span class="mileage-expiry-3m-detail-title">사용 내역</span>';
                if (v.deductions && v.deductions.length) {
                    v.deductions.forEach(function(d) {
                        detailRows += '<div class="mileage-expiry-3m-detail-row">' + d.date + ' ' + d.content + ' <span class="amount-minus">-' + d.amount.toFixed(1) + ' M</span></div>';
                    });
                } else {
                    detailRows += '<div class="mileage-expiry-3m-detail-row">없음</div>';
                }
                detailRows += '</div>';
                listHtml += '<div class="mileage-expiry-3m-item" data-key="' + key + '">' +
                    '<div class="mileage-expiry-3m-head" onclick="toggleMileageExpiryDetail(\'' + key + '\')">' +
                    '<div class="mileage-expiry-3m-head-left"><span class="mileage-expiry-month">' + label + '</span><span class="mileage-expiry-3m-label">소멸예정 마일리지 <span class="mileage-expiry-3m-lastday">' + lastDayShort + ' 소멸</span></span></div>' +
                    '<div class="mileage-expiry-3m-head-right"><span class="mileage-expiry-amount">' + amountStr + ' M</span><span class="mileage-expiry-3m-chevron" id="chevron-' + key.replace('-', '_') + '">∨</span></div>' +
                    '</div>' +
                    '<div class="mileage-expiry-3m-detail" id="detail-' + key.replace('-', '_') + '">' + detailRows + '</div>' +
                    '</div>';
            });
            var wrap = document.getElementById('mileageExpiryByMonthBody');
            if (wrap) wrap.innerHTML = listHtml;
            var modal = document.getElementById('mileageExpiryByMonthModal');
            if (modal) modal.style.display = 'flex';
        }
        function toggleMileageExpiryDetail(key) {
            var id = key.replace('-', '_');
            var detail = document.getElementById('detail-' + id);
            var chevron = document.getElementById('chevron-' + id);
            if (detail && chevron) {
                detail.classList.toggle('open');
                chevron.classList.toggle('open');
            }
        }
        function closeMileageExpiryByMonthModal() {
            var modal = document.getElementById('mileageExpiryByMonthModal');
            if (modal) modal.style.display = 'none';
        }

        function renderTable(tabType) {
            var data, tbody, pagination;
            switch(tabType) {
                case 'charge': data = chargeHistoryData; tbody = document.getElementById('historyChargeBody'); pagination = document.getElementById('paginationCharge'); break;
                case 'mileage': data = mileageHistoryData; tbody = document.getElementById('historyMileageBody'); pagination = document.getElementById('paginationMileage'); break;
                case 'use': data = useHistoryData; tbody = document.getElementById('historyUseBody'); pagination = document.getElementById('paginationUse'); break;
                default: data = chargeHistoryData; tbody = document.getElementById('historyChargeBody'); pagination = document.getElementById('paginationCharge'); break;
            }
            var currentPage = currentPages[tabType];
            var totalPages = Math.ceil(data.length / ITEMS_PER_PAGE) || 1;
            var startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
            var endIndex = startIndex + ITEMS_PER_PAGE;
            var pageData = data.slice(startIndex, endIndex);

            var html = '';
            pageData.forEach(function(item) {
                var amountClass = item.amount.indexOf('+') === 0 ? 'amount-plus' : 'amount-minus';
                if (tabType === 'charge') {
                    var method = item.content.replace('포인트 충전 (', '').replace(')', '');
                    html += '<tr><td>' + item.date + '</td><td>' + method + '</td><td class="' + amountClass + '">' + item.amount + '</td><td>' + item.balance + '</td></tr>';
                } else if (tabType === 'mileage') {
                    var mileageKind = item.type === 'mileage_use' ? '사용' : '적립';
                    html += '<tr><td>' + item.date + '</td><td><span class="status-badge status-' + item.type + '">' + mileageKind + '</span></td><td>' + item.content + '</td><td class="' + amountClass + '">' + item.amount + '</td><td>' + item.balance + '</td></tr>';
                } else if (tabType === 'use') {
                    var serviceParts = item.content.split(' (');
                    var service = serviceParts[0];
                    var count = serviceParts[1] ? serviceParts[1].replace(')', '') : '-';
                    html += '<tr><td>' + item.date + '</td><td>' + service + '</td><td>' + count + '</td><td class="' + amountClass + '">' + item.amount + '</td><td>' + item.balance + '</td></tr>';
                }
            });
            tbody.innerHTML = html;

            if (pagination) renderPagination(tabType, currentPage, totalPages, data.length, pagination);
        }

        function renderPagination(tabType, currentPage, totalPages, totalItems, container) {
            if (totalPages <= 1) { container.innerHTML = ''; return; }
            var html = '';
            html += '<button class="pagination-btn" ' + (currentPage === 1 ? 'disabled' : '') + ' onclick="goToHistoryPage(\'' + tabType + '\', ' + (currentPage - 1) + ')">&lsaquo;</button>';
            var startPage = Math.max(1, currentPage - 2);
            var endPage = Math.min(totalPages, currentPage + 2);
            for (var i = startPage; i <= endPage; i++) {
                html += '<button class="pagination-btn' + (i === currentPage ? ' active' : '') + '" onclick="goToHistoryPage(\'' + tabType + '\', ' + i + ')">' + i + '</button>';
            }
            html += '<button class="pagination-btn" ' + (currentPage === totalPages ? 'disabled' : '') + ' onclick="goToHistoryPage(\'' + tabType + '\', ' + (currentPage + 1) + ')">&rsaquo;</button>';
            html += '<span class="pagination-info">' + (((currentPage - 1) * ITEMS_PER_PAGE + 1)) + '-' + Math.min(currentPage * ITEMS_PER_PAGE, totalItems) + ' / 총 ' + totalItems + '건</span>';
            container.innerHTML = html;
        }

        function goToHistoryPage(tabType, page) {
            currentPages[tabType] = page;
            renderTable(tabType);
        }

        function switchHistoryTab(tab) {
            document.querySelectorAll('.history-tab').forEach(function(t) { t.classList.remove('active'); });
            document.querySelectorAll('.history-content').forEach(function(c) { c.classList.remove('active'); });
            var tabs = document.querySelectorAll('.history-tab');
            if (tab === 'charge') { tabs[0].classList.add('active'); document.getElementById('historyCharge').classList.add('active'); }
            else if (tab === 'use') { tabs[1].classList.add('active'); document.getElementById('historyUse').classList.add('active'); }
            else if (tab === 'mileage') { tabs[2].classList.add('active'); document.getElementById('historyMileage').classList.add('active'); }
            renderTable(tab);
        }
        function applyHistoryPeriod(period) {
            var fromEl = document.getElementById('historyDateFrom');
            var toEl = document.getElementById('historyDateTo');
            var end = new Date();
            var start = new Date();
            if (period === 'custom') {
                if (fromEl && toEl && fromEl.value && toEl.value) { /* 실제 API 호출 시 기간 전달 */ }
                return;
            }
            var n = parseInt(period, 10) || 1;
            start.setMonth(start.getMonth() - n);
            if (fromEl) fromEl.value = start.getFullYear() + '-' + ('0' + (start.getMonth() + 1)).slice(-2) + '-' + ('0' + start.getDate()).slice(-2);
            if (toEl) toEl.value = end.getFullYear() + '-' + ('0' + (end.getMonth() + 1)).slice(-2) + '-' + ('0' + end.getDate()).slice(-2);
        }

        function applyMypagePanelFromHash() {
            var hash = (location.hash || '').replace(/^#/, '');
            if (hash && ['profile', 'password', 'caller', 'history'].indexOf(hash) !== -1) {
                switchMypagePanel(hash);
            } else {
                // 해시 없거나 잘못된 해시면 내정보수정(profile) 표시
                switchMypagePanel('profile');
            }
        }
        window.switchMypagePanel = switchMypagePanel;
        window.applyMypagePanelFromHash = applyMypagePanelFromHash;

        document.addEventListener('DOMContentLoaded', function() {
            if (typeof initDropdownMenus === 'function') initDropdownMenus();
            updateMemberTypeDisplay();
            applyMypagePanelFromHash();
        });
        window.addEventListener('hashchange', applyMypagePanelFromHash);
    </script>
    <script src="js/footer.js"></script>
    <script>
        document.write(createFloatingMenu());
        document.write(createFooter());
    </script>
    <!-- 화면설계 오버레이 (다른 페이지와 동일한 번호 마커 + 호버 툴팁 방식) -->
    <script src="js/spec-overlay.js"></script>
    <script>
        const specData = [
            { selector: '#pageHeader h2', title: '1. 페이지 제목', position: { top: '-5px', left: '-10px' }, function: '마이페이지 메인 타이틀. 회원정보·설정·이용내역 관리 진입점.' },
            { selector: '#pageHeader .page-description', title: '2. 페이지 설명', position: { top: '-5px', left: '-10px' }, function: '회원정보를 확인하고 내 정보, 비밀번호, 발신번호, 이용내역을 관리합니다 안내.' },
            { selector: '#dashboardMemberType', title: '3. 회원유형', position: { top: '-5px', right: '-10px' }, function: '로그인 회원의 유형 표시(개인회원/기업회원). 대시보드와 동일한 요약 영역.' },
            { selector: '#dashboardMemberGrade', title: '4. 회원등급', position: { top: '-5px', right: '-10px' }, function: '회원등급 표시(일반 등).' },
            { selector: '#dashboardBalance', title: '5. 잔액', position: { top: '-5px', right: '-10px' }, function: '포인트·마일리지 등 잔액 정보. 전용계좌 안내 포함.' },
            { selector: '#dashboardSendCounts', title: '6. 발송 가능 건수', position: { top: '-5px', right: '-10px' }, function: '일반/광고/선거 등 발송 가능 건수 뱃지 표시.' },
            { selector: '#mypageLnb .mypage-lnb-item:nth-child(1)', title: '7. 내정보수정', position: { top: '-5px', left: '-10px' }, function: '클릭 시 내정보수정 패널로 전환. 기본 정보·주소·회원유형 전환·세금계산서 신청 등.' },
            { selector: '#mypageLnb .mypage-lnb-item:nth-child(2)', title: '8. 비밀번호변경', position: { top: '-5px', left: '-10px' }, function: '클릭 시 비밀번호 변경 패널로 전환.' },
            { selector: '#mypageLnb .mypage-lnb-item:nth-child(3)', title: '9. 발신번호관리', position: { top: '-5px', left: '-10px' }, function: '클릭 시 발신번호 목록·등록·상태 필터 패널로 전환.' },
            { selector: '#mypageLnb .mypage-lnb-item:nth-child(4)', title: '10. 포인트/마일리지 내역', position: { top: '-5px', left: '-10px' }, function: '클릭 시 포인트/마일리지 이용내역 패널로 전환. 기간 조회·탭별 내역 제공.' },
            { selector: '#basicInfoSection .form-section-title', title: '11. 기본 정보 섹션', position: { top: '-5px', left: '-10px' }, function: '기본 정보 구역 구분.' },
            { selector: '#basicInfoSection .form-group input[disabled]', title: '12. 아이디', position: { top: '-5px', right: '-10px' }, function: '로그인 아이디 조회 전용. 수정 불가(disabled), 회색 배경.' },
            { selector: '#profileUserName', title: '13. 이름', position: { top: '-5px', right: '-10px' }, function: '회원 이름 수정. 한글/영문 2~20자, 필수.' },
            { selector: '#basicInfoSection input[type="date"]', title: '14. 생년월일', position: { top: '-5px', right: '-10px' }, function: '날짜 선택(YYYY-MM-DD). 선택 항목.' },
            { selector: '#basicInfoSection input[type="tel"]', title: '15. 휴대폰번호', position: { top: '-5px', right: '-10px' }, function: '010-XXXX-XXXX 형식. 필수. 하이픈 자동 입력.' },
            { selector: '#basicInfoSection .phone-verify .btn', title: '16. 휴대폰 인증 버튼', position: { top: '-5px', right: '-10px' }, function: '클릭 시 휴대폰 인증 모달 오픈. SMS 인증번호 발송·입력 후 인증 완료 처리.' },
            { selector: '#basicInfoSection input[type="email"]', title: '17. 이메일 주소', position: { top: '-5px', right: '-10px' }, function: '이메일 형식 검증, 필수.' },
            { selector: '#basicInfoSection button[onclick="checkEmail()"]', title: '18. 이메일 중복 확인', position: { top: '-5px', right: '-10px' }, function: '입력 이메일이 기존 회원과 중복인지 확인. 사용 가능/이미 사용 중 메시지.' },
            { selector: '#addressSection button[onclick="openAddressSearch()"]', title: '19. 주소 검색', position: { top: '-5px', right: '-10px' }, function: '주소 검색 클릭 시 Daum 우편번호 API 팝업. 선택 시 우편번호·주소 자동 입력.' },
            { selector: '#addressSection .form-group:nth-child(2) .form-input', title: '20. 주소', position: { top: '-5px', right: '-10px' }, function: '우편번호 검색 후 자동 입력. 기본 주소(수정 불가).' },
            { selector: '#addressSection .form-group:last-child .form-input', title: '21. 상세주소', position: { top: '-5px', right: '-10px' }, function: '직접 입력. 선택 항목.' },
            { selector: '#joinDateSection .form-input', title: '22. 회원가입일', position: { top: '-5px', right: '-10px' }, function: '가입일 조회 전용. 수정 불가.' },
            { selector: '#saveProfileBtn', title: '23. 저장하기', position: { top: '-5px', left: '-10px' }, function: '수정 정보 검증 후 저장. 필수값·형식·인증 완료 여부 등 검증. 성공 시 안내 메시지.' },
            { selector: '#cancelProfileBtn', title: '24. 취소', position: { top: '-5px', right: '-10px' }, function: '입력 내용 초기화, 원래 값으로 복원.' },
            { selector: '#businessInfoCard .card-title', title: '25. 기업 정보 카드', position: { top: '-5px', left: '-10px' }, function: '기업회원일 때만 표시. 회사명·사업자등록번호·대표자명·사업장 주소(3칸: 우편번호 검색, 주소 자동입력, 상세주소 직접입력) 조회·수정.', behavior: ['사업장 주소: openBusinessAddressSearch()로 우편번호 검색 후 주소 자동 입력, 상세주소는 회원 입력'] },
            { selector: 'button[onclick="openModal(\'taxAutoApplyModal\')"]', title: '26. 세금계산서 자동발행 신청', position: { top: '-5px', right: '-10px' }, function: '기업회원 전용. 클릭 시 세금계산서 자동발행 신청 모달 오픈. 담당자 정보 입력 후 신청.' },
            { selector: '#currentMemberTypeText', title: '27. 현재 회원유형 표시', position: { top: '-5px', right: '-10px' }, function: '현재 회원유형 표시(개인회원 등).' },
            { selector: '#memberTypeCard a[href="mypage-convert-business.html"]', title: '28. 개인사업자 전환 신청', position: { top: '-5px', right: '-10px' }, function: '개인→개인사업자 전환. 클릭 시 mypage-convert-business.html 이동.' },
            { selector: '#memberTypeCard a[href="mypage-convert-corporate.html"]', title: '29. 법인사업자 전환 신청', position: { top: '-5px', right: '-10px' }, function: '개인/개인사업자→법인사업자 전환. 클릭 시 mypage-convert-corporate.html 이동.' },
            { selector: '#panel-profile .alert-info', title: '30. 대행업체 안내', position: { top: '10px', left: '-10px' }, function: '대행업체 회원 시 계정 분리 안내. 고객센터 문의 유도.' },
            { selector: 'a[onclick="openWithdrawalModal()"]', title: '31. 회원 해지', position: { top: '-5px', left: '-10px' }, function: '회원 탈퇴(해지) 절차 진입. 잔여 포인트에 따라 확인 모달 문구·버튼 분기.', behavior: ['1만 포인트 이상: 환불 안내 문구+잔여 포인트/마일리지 노출, 취소/환불 진행(클릭 시 support-inquiry.html#refund 이동)', '1만 포인트 미만: 탈퇴 확인 문구, 아니오/예(예 선택 시 본인인증 단계로 이동)'] },
            { selector: 'a[onclick="openWithdrawalModal(true)"]', title: '31-1. 1만 포인트 미만 회원해지 예시', position: { top: '-5px', left: '-10px' }, function: 'openWithdrawalModal(true) 호출. 잔여 포인트와 무관하게 1만 포인트 미만일 때의 회원해지 팝업(예/아니오)을 확인용으로 표시.' },
            { selector: '#currentPassword', title: '32. 현재 비밀번호', position: { top: '-5px', right: '-10px' }, function: '변경 전 본인 확인용. 필수. 타입 password, 표시/숨김 토글 가능.' },
            { selector: '#newPassword', title: '33. 새 비밀번호', position: { top: '-5px', right: '-10px' }, function: '8~16자, 영문·숫자·특수문자 중 3종 이상 등 규칙 적용. 필수.' },
            { selector: '#confirmPassword', title: '34. 새 비밀번호 확인', position: { top: '-5px', right: '-10px' }, function: '새 비밀번호와 일치 여부 실시간 체크. 필수.' },
            { selector: '#changePasswordBtn', title: '35. 변경하기', position: { top: '-5px', left: '-10px' }, function: '검증 후 비밀번호 변경 API 호출. 성공 시 완료 메시지 및 로그인 페이지 이동 등.' },
            { selector: '#cancelBtn', title: '36. 취소', position: { top: '-5px', right: '-10px' }, function: '입력 초기화 또는 이전 패널/페이지로 이동.' },
            { selector: '#callerNumberNotice', title: '37. 발신번호 사전등록제 안내', position: { top: '10px', left: '-10px' }, function: '정보통신망법에 따른 사전 등록 의무·승인 소요 기간(1~3일) 안내.' },
            { selector: '#agencyNotice', title: '38. 대행업체 안내', position: { top: '10px', left: '-10px' }, function: '대행업체 회원 시 고객사별 계정 생성·고객센터 문의 안내.' },
            { selector: '#callerNumberCard .card-title', title: '39. 발신번호 목록', position: { top: '-5px', left: '-10px' }, function: '발신번호 목록 섹션 제목.' },
            { selector: '#registerCallerBtn', title: '40. 발신번호 등록', position: { top: '-5px', right: '-10px' }, function: '클릭 시 mypage-caller-number.html(발신번호 등록 페이지)로 이동.' },
            { selector: '#statusFilter button[data-filter="all"]', title: '41. 상태 필터 - 전체', position: { top: '-5px', left: '-10px' }, function: '발신번호 목록을 전체 상태로 조회.', behavior: ['【상태 항목】 전체, 승인대기, 승인완료, 반려'] },
            { selector: '#statusFilter button[data-filter="pending"]', title: '42. 상태 필터 - 승인대기', position: { top: '-5px', left: '-10px' }, function: '승인 대기 중인 발신번호만 표시.' },
            { selector: '#statusFilter button[data-filter="approved"]', title: '43. 상태 필터 - 승인완료', position: { top: '-5px', left: '-10px' }, function: '승인 완료된 발신번호만 표시.' },
            { selector: '#statusFilter button[data-filter="rejected"]', title: '44. 상태 필터 - 반려', position: { top: '-5px', right: '-10px' }, function: '반려된 발신번호만 표시.' },
            { selector: '#callerNumberTable', title: '45. 발신번호 목록 테이블', position: { top: '10px', left: '10px' }, function: '발신번호·통신사·명의·상태·등록일·승인일·관리(삭제/—/반려사유) 컬럼. 승인대기 시 관리 칸은 상세보기 없이 — 표시.', behavior: ['【명의 컬럼값】 본인(본인 명의), 타인(타인 명의), 타사(타사/타기업 명의) 구분', '【상태 컬럼 값】 승인완료(녹색), 승인대기(노란색), 반려(빨간색)', '【발신번호 셀】 클릭 시 용도 수정 모달 열림'] },
            { selector: '.caller-number-cell-mypage', title: '45-1. 발신번호(상세)', position: { top: '-5px', left: '-10px' }, description: '클릭 시 용도 수정 모달', function: 'openEditPurposeModalMypage(id, 번호, 현재용도) 호출 → 용도 수정 팝업', behavior: ['발신번호·괄호 안 용도 표시', '클릭 시 용도 수정 모달에서 용도 변경 가능'] },
            { selector: '#callerNumberTableBody button[onclick*="deleteCallerNumberMypage"]', title: '46. 삭제 버튼', position: { top: '-5px', left: '-10px' }, function: '해당 발신번호 삭제. 확인 후 목록에서 제거.' },
            { selector: '#callerNumberTableBody tr[data-status="pending"] td:last-child', title: '47. 승인대기 행 관리 칸', position: { top: '-5px', left: '-10px' }, function: '승인대기 시 상세보기 버튼 없음, — 표시.' },
            { selector: '#callerNumberTableBody button[onclick*="viewRejectionReasonMypage"]', title: '48. 반려사유 버튼', position: { top: '-5px', right: '-10px' }, function: '반려된 건의 반려 사유 팝업/페이지 표시.' },
            { selector: '#historyCard .card-title', title: '49. 포인트/마일리지 내역', position: { top: '-5px', left: '-10px' }, function: '포인트/마일리지 내역 섹션 제목.' },
            { selector: '#historyDateFrom', title: '50. 조회 시작일', position: { top: '-5px', left: '-10px' }, function: '달력으로 조회 시작일 선택. 과거 데이터 검색용. 선택 구간은 최대 1년.', behavior: ['달력+검색은 과거 구간 직접 선택 조회(최대 1년)'] },
            { selector: '#historyDateTo', title: '51. 조회 종료일', position: { top: '-5px', left: '-10px' }, function: '달력으로 조회 종료일 선택. 과거 데이터 검색용. 시작일~종료일 최대 1년.' },
            { selector: '.history-period-btns button[onclick="applyHistoryPeriod(\'1\')"]', title: '52. 1개월', position: { top: '-5px', left: '-10px' }, function: '최근 기준: 오늘부터 과거 1개월 구간 자동 설정 후 내역 조회.', behavior: ['기간 버튼은 최근 기준 조회'] },
            { selector: '.history-period-btns button[onclick="applyHistoryPeriod(\'3\')"]', title: '53. 3개월', position: { top: '-5px', left: '-10px' }, function: '최근 기준: 오늘부터 과거 3개월 구간 자동 설정 후 내역 조회.' },
            { selector: '.history-period-btns button[onclick="applyHistoryPeriod(\'6\')"]', title: '54. 6개월', position: { top: '-5px', left: '-10px' }, function: '최근 기준: 오늘부터 과거 6개월 구간 자동 설정 후 내역 조회.' },
            { selector: '.history-period-btns button[onclick="applyHistoryPeriod(\'12\')"]', title: '55. 1년', position: { top: '-5px', left: '-10px' }, function: '최근 기준: 오늘부터 과거 1년 구간 자동 설정 후 내역 조회.' },
            { selector: '#historySearchBtn', title: '56. 검색 버튼', position: { top: '-5px', right: '-10px' }, function: '달력으로 선택한 시작일·종료일(과거 구간, 최대 1년)로 내역 조회.' },
            { selector: '#historyTabs .history-tab:nth-child(1)', title: '57. 포인트 충전 내역 탭', position: { top: '-5px', left: '-10px' }, function: '포인트 충전 내역 탭 선택. 날짜·결제수단·금액·잔액 등 표시.' },
            { selector: '#historyTabs .history-tab:nth-child(2)', title: '58. 포인트 사용 내역 탭', position: { top: '-5px', left: '-10px' }, function: '포인트 사용 내역 탭 선택. 날짜·서비스·발송 건수·금액·잔액 등 표시.' },
            { selector: '#historyTabs .history-tab:nth-child(3)', title: '59. 마일리지 적립/사용 내역 탭', position: { top: '-5px', left: '-10px' }, function: '마일리지 적립·사용 내역 탭 선택.' },
            { selector: 'button[onclick="openMileageExpiryByMonthModal()"]', title: '60. 소멸 예정 마일리지', position: { top: '-5px', right: '-10px' }, function: '클릭 시 소멸 예정 마일리지 모달 오픈. 당월 포함 3개월 소멸 예정 내역 표시.' },
            { selector: '#historyCharge .table-container .table', title: '61. 포인트 충전 내역 테이블', position: { top: '10px', left: '10px' }, function: '충전 일시·결제수단·금액·잔액 목록. 페이지네이션 포함.' },
            { selector: '#historyUse .table-container .table', title: '62. 포인트 사용 내역 테이블', position: { top: '10px', left: '10px' }, function: '사용 일시·서비스·발송 건수·금액·잔액 목록. 페이지네이션 포함.' },
            { selector: '#historyMileage .table-container .table', title: '63. 마일리지 적립/사용 내역 테이블', position: { top: '10px', left: '10px' }, function: '일시·구분·내용·금액·잔액 목록. 페이지네이션 포함.' },
            { selector: '#phoneVerifyModal .modal-title', title: '64. 휴대폰 인증 모달', position: { top: '-5px', left: '-10px' }, function: '휴대폰번호 확인·인증번호 입력·재전송·확인. 인증 완료 시 내정보 수정 폼에 반영.' },
            { selector: '#mileageExpiryByMonthModal .modal-title', title: '65. 소멸 예정 마일리지 모달', position: { top: '-5px', left: '-10px' }, function: '당월 포함 이후 3개월 소멸 예정 마일리지 내역. 확인 버튼으로 닫기.' },
            { selector: '#taxAutoApplyModal .modal-title', title: '66. 세금계산서 자동발행 신청 모달', position: { top: '-5px', left: '-10px' }, function: '담당자 이름·연락처·수신 이메일 입력 후 신청. 취소/신청 버튼.' },
            { selector: '#withdrawalConfirmModal', title: '67. 회원 해지 1단계 확인 모달', position: { top: '10px', left: '10px' }, function: '잔여 포인트에 따라 안내 문구·버튼 분기. 1만 P 이상: 000님 잠시만요! / 아직 사용하지 않은 포인트가 남아있습니다. 환불을 진행해주세요. + 잔여 포인트/마일리지 노출, 취소/환불 진행(환불 진행 시 support-inquiry.html#refund 이동). 1만 P 미만: 000님 잠시만요! / 해지하시면 고객님의 소중한 정보와 혜택이 모두 소멸됩니다. 탈퇴하시겠습니까? 아니오/예(예 시 2단계 휴대폰 인증 모달로 이동).' },
            { selector: '#withdrawalAuthModal', title: '68. 회원 해지 2단계 휴대폰 인증 모달', position: { top: '10px', left: '10px' }, function: '본인 명의 휴대폰 인증. 인증 완료 후 회원 해지 처리.' }
        ];
        initSpecOverlay(specData);
    </script>
</body>
</html>
